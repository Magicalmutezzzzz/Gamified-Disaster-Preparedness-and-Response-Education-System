<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Module 6 — Assignment 2: Pre-Event Awareness and Planning</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
    :root{
      --bg:#07102a; --card:#0f1724; --muted:#cfe5ff;
      --accent:#ff6b35; --success:#22c55e; --danger:#ef4444;
      --glass: rgba(255,255,255,0.03); --maxw:1100px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,var(--bg), #021024);color:#e6f0ff;-webkit-font-smoothing:antialiased}
    .wrap{max-width:var(--maxw);margin:28px auto;padding:20px;display:grid;grid-template-columns:1fr 380px;gap:20px}
    .left,.right{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    h1{margin:0;font-size:20px;color:var(--accent)}
    .sub{color:var(--muted);font-size:13px}
    .video-wrap{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:12px;border-radius:10px;box-shadow:0 8px 24px rgba(2,6,23,0.6)}
    .video-embed{width:100%;height:0;padding-bottom:56.25%;position:relative;border-radius:8px;overflow:hidden}
    .video-embed iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
    form.quiz{margin-top:18px;display:flex;flex-direction:column;gap:12px}
    .question{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px}
    .question h4{margin:0 0 8px;font-size:14px}
    .opt{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;cursor:pointer}
    .opt:hover{background:rgba(255,255,255,0.02)}
    .actions{display:flex;gap:10px;align-items:center;margin-top:10px}
    .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .note{font-size:13px;color:var(--muted)}
    .card-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .stats{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .stat{display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(2,6,23,0.5),rgba(2,6,23,0.6))}
    .modal-inner{background:var(--card);padding:20px;border-radius:12px;width:360px;text-align:center}
    .close-btn{background:#fff;color:#000;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    .progress-ring{width:200px;height:200px;margin:10px auto}
    .correct{border-left:6px solid var(--success)} .incorrect{border-left:6px solid var(--danger)}
    @media(max-width:980px){.wrap{grid-template-columns:1fr}.right{order:2}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="left">
      <header>
        <div>
          <h1>Module 6 • Crowd Safety</h1>
          <div class="sub">Assignment 2 — Pre-Event Awareness and Planning</div>
        </div>
        <div style="text-align:right">
          <div class="sub">Est. time: <strong>6–8 min</strong></div>
          <a class="btn ghost" href="module6.html" style="margin-top:8px;display:inline-block">Back to Module</a>
        </div>
      </header>

      <div class="video-wrap">
        <div class="video-embed" aria-hidden="false">
          <iframe src="https://www.youtube.com/embed/meupAZG5LTA"
            title="Pre-Event Awareness and Planning" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
      </div>

      <form class="quiz" id="quizForm" aria-label="Quiz for Assignment 2"></form>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
        <div class="note">Each question: <strong>1 mark</strong>. Total: 10 marks.</div>
        <div class="actions">
          <button class="btn" id="submitBtn" type="button">Submit Answers</button>
          <button class="btn ghost" id="clearBtn" type="button">Reset Answers</button>
        </div>
      </div>
    </div>

    <aside class="right" aria-label="Progress & Stats">
      <div class="card-title">
        <div><strong style="color:var(--muted)">Progress</strong><div style="font-size:12px;color:#bcd8ff">Module 6 — Crowd Safety</div></div>
        <div style="font-size:12px;color:var(--muted)">Assignment 2</div>
      </div>

      <div style="text-align:center">
        <svg viewBox="0 0 36 36" class="progress-ring" id="progressSvg" aria-hidden>
          <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#374151" stroke-width="3.5"></path>
          <path id="progressArc" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#22c55e" stroke-width="3.5" stroke-dasharray="0 100"></path>
          <text x="18" y="20.5" font-size="6" text-anchor="middle" fill="#fff" id="progressText">0%</text>
        </svg>
      </div>

      <div class="stats">
        <div class="stat"><div style="font-size:14px">Completed Assignments</div><div id="completedCount">0 / 15</div></div>
        <div class="stat"><div style="font-size:14px">Your score (this assignment)</div><div id="lastScore">—</div></div>
        <div class="stat"><div style="font-size:14px">Module Avg. (so far)</div><div id="avgScore">—</div></div>
      </div>

      <div style="margin-top:12px;font-size:13px;color:var(--muted)">
        Tip: Role plays and a ready follow-up plan dramatically increase ROI from events — watch the video for practical templates.
      </div>
    </aside>
  </div>

  <div class="modal" id="resultModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-inner" role="document">
      <h3>Result</h3>
      <p id="modalMsg">You scored X / 10</p>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
        <button class="close-btn" id="modalOk">OK</button>
      </div>
    </div>
  </div>

  <script>
    // Assignment 2 questions
    const QUESTIONS = [
      { q: "According to the video, what is the first and most fundamental step you must define during the 'Internal Preparation' phase for attending an event?", options: ["Finalize the event budget and travel arrangements for the team.","Define the success criteria and specific goals for attending the event (e.g., create buzz vs. meet customers).","Assign a lead for scanning hundreds of leads during the event hours.","Design the visuals for the booth and ensure matching team t-shirts are ordered."], a: 1 },
      { q: "In the 'Internal Preparation' phase, what key logistical reminders should the team receive?", options: ["A mandate to only speak to Tier 1 prospects and ignore all other attendees.","A detailed schedule of every keynote speech they must attend.","Reminders about basic comfort needs, such as wearing comfortable shoes and planning for dietary restrictions.","Instructions to stay at the booth for 12 hours straight to maximize lead scanning."], a: 2 },
      { q: "What is the purpose of conducting 'role plays' with your team before the event?", options: ["To determine which team member is best at using the lead scanning technology.","To ensure that every opportunity for a positive interaction is met with preparation from the team based on different customer personas.","To practice avoiding conversations with competitors and journalists.","To test how quickly the team can set up and tear down the physical booth."], a: 1 },
      { q: "Why does the video state that relying only on 'matching t-shirts and a splashy booth' for attention is setting yourself up for failure?", options: ["Physical booths are prone to being placed in poor locations with low traffic.","The t-shirts and booths are often too expensive and waste the event budget.","It fails to create advanced awareness that your company will be at the event using digital channels.","Attendees are often too exhausted by the time they reach the booth to engage."], a: 2 },
      { q: "What is the key strategic advantage of hosting a 'satellite action' like a memorable dinner or coffee meet-up in the new event city?", options: ["It provides a guaranteed way to scan more than 100 new leads for the database.","It ensures that the team has a chance to enjoy the city's best restaurants.","It creates a much more appealing excuse for an intimate, in-person interaction than an impersonal Zoom or Slack message.","It is cheaper than renting a booth space or paying for event sponsorship."], a: 2 },
      { q: "Why must the team have a structured follow-up plan 'ready to hit play on' as soon as the event wraps up?", options: ["To ensure immediate billing for any deals that were closed at the event.","To beat the competition, as leads will be speaking to dozens of companies and will be overwhelmed with follow-up communication.","To comply with event organizer rules about contact information usage.","To provide the marketing team with content for a post-event recap video."], a: 1 },
      { q: "Which of the following is not one of the three core strategic elements for making the most out of any event, as defined in the video?", options: ["On-Site Product Launch","Having a Follow-up Plan","Internal Preparation","Attracting an Audience (Pre-Event Outreach)"], a: 0 },
      { q: "What is the main goal that the follow-up plan must structure to effectively convert a short 5-10 minute booth conversation?", options: ["A personalized message to thank the event organizers for their service.","A detailed analysis of all the swag given out at the booth.","How to translate the short conversations into the success metrics defined at the beginning of the planning process.","A list of which team members get credit for which leads they scanned."], a: 2 },
      { q: "In the 'Attracting an Audience' phase, the advanced knowledge of your company being at the event makes people more likely to do what?", options: ["Sign up for a job interview with your company.","Stop by, say hello, and potentially take the first few steps in a relationship.","Agree to an immediate purchase order at the booth.","Post pictures of your booth and matching t-shirts on social media."], a: 1 },
      { q: "What specifically does the video suggest should be used to create awareness that you're going to be somewhere, rather than just relying on your booth?", options: ["Sending physical mailers to everyone in the event city.","Targeted television and radio advertisements.","Social media.","Emailing a newsletter to your employees."], a: 2 }
    ];

    const MODULE_ID = 6;
    const ASSIGNMENT_NUMBER = 2;
    const TOTAL_ASSIGNMENTS = 15;

    const quizForm = document.getElementById('quizForm');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultModal = document.getElementById('resultModal');
    const modalMsg = document.getElementById('modalMsg');
    const modalOk = document.getElementById('modalOk');
    const completedCountEl = document.getElementById('completedCount');
    const lastScoreEl = document.getElementById('lastScore');
    const avgScoreEl = document.getElementById('avgScore');
    const progressText = document.getElementById('progressText');
    const progressArc = document.getElementById('progressArc');

    function getToken(){ return sessionStorage.getItem('lifesafe_access'); }

    async function apiFetch(path, method='GET', body=null){
      const headers = {};
      const token = getToken();
      if(token) headers['Authorization'] = 'Bearer ' + token;
      if(body) headers['Content-Type'] = 'application/json';
      const opts = { method, headers };
      if(body) opts.body = JSON.stringify(body);
      try {
        const res = await fetch(window.location.origin + path, opts);
        const data = await res.json().catch(()=>({ok:false}));
        return { status: res.status, data };
      } catch (err) {
        return { status: 0, data: { ok:false, message: 'Network error' } };
      }
    }

    function renderQuestions(){
      QUESTIONS.forEach((item, idx) => {
        const q=document.createElement('div'); q.className='question';
        q.innerHTML = `<h4>Q${idx+1}. ${item.q}</h4><div class="options"></div>`;
        const opts = q.querySelector('.options');
        item.options.forEach((o,oi)=> {
          const label=document.createElement('label'); label.className='opt';
          label.innerHTML = `<input type="radio" name="q${idx}" value="${oi}"> <span style="font-size:14px">${o}</span>`;
          opts.appendChild(label);
        });
        quizForm.appendChild(q);
      });
    }

    async function loadProgress(){
      const res = await apiFetch(`/api/module/${MODULE_ID}/progress`);
      if(res.status === 200 && res.data.ok){
        const p = res.data;
        const done = (p.completed || []).length;
        completedCountEl.textContent = `${done} / ${TOTAL_ASSIGNMENTS}`;
        lastScoreEl.textContent = (p.scores && p.scores[ASSIGNMENT_NUMBER] !== undefined) ? `${p.scores[ASSIGNMENT_NUMBER]} / ${QUESTIONS.length}` : '—';
        const arr = Object.values(p.scores || {}).filter(v => typeof v === 'number');
        avgScoreEl.textContent = arr.length ? (arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(1) + ` / ${QUESTIONS.length}` : '—';
        const pct = Math.round((done / TOTAL_ASSIGNMENTS) * 100);
        progressText.textContent = pct + '%';
        const circumference = 100;
        const dash = Math.round((pct/100) * circumference);
        progressArc.setAttribute('stroke-dasharray', `${dash} ${circumference - dash}`);
      } else {
        // fallback display
        completedCountEl.textContent = `0 / ${TOTAL_ASSIGNMENTS}`;
        lastScoreEl.textContent = '—';
        avgScoreEl.textContent = '—';
      }
    }

    async function saveProgress(state){ await apiFetch(`/api/module/${MODULE_ID}/progress`,'POST',state); }

    function validate(){ for(let i=0;i<QUESTIONS.length;i++){ if(!document.querySelector(`input[name=q${i}]:checked`))return false;} return true; }

    async function gradeAndSave(){
      let score=0;
      QUESTIONS.forEach((it,i)=>{
        const ans=document.querySelector(`input[name=q${i}]:checked`);
        if(ans && parseInt(ans.value)===it.a) score++;
        const qDiv = ans ? ans.closest('.question') : document.getElementsByClassName('question')[i];
        if(qDiv){ if(ans && parseInt(ans.value)===it.a){ qDiv.classList.add('correct'); qDiv.classList.remove('incorrect'); } else { qDiv.classList.add('incorrect'); qDiv.classList.remove('correct'); } }
      });

      const res = await apiFetch(`/api/module/${MODULE_ID}/progress`);
      const state = (res.status===200 && res.data.ok) ? res.data : { completed: [], scores: {} };
      state.completed = state.completed || [];
      state.scores = state.scores || {};
      if(!state.completed.includes(ASSIGNMENT_NUMBER)) state.completed.push(ASSIGNMENT_NUMBER);
      state.scores[ASSIGNMENT_NUMBER] = score;
      await saveProgress(state);

      modalMsg.textContent = `You scored ${score} / ${QUESTIONS.length}`;
      resultModal.style.display='flex';
      await loadProgress();
      submitBtn.disabled=true; submitBtn.textContent='Submitted ✓';
    }

    submitBtn.onclick=async()=>{
      if(!getToken()){ alert('Login required'); return; }
      if(!validate()){ alert('Answer all'); return; }
      await gradeAndSave();
    };
    clearBtn.onclick=()=>{ document.querySelectorAll('input[type=radio]').forEach(r=>r.checked=false); document.querySelectorAll('.question').forEach(q=>{q.classList.remove('correct','incorrect')}); submitBtn.disabled=false; submitBtn.textContent='Submit Answers'; };
    modalOk.onclick=()=>{ resultModal.style.display='none'; window.location.href='module6.html'; };

    renderQuestions(); loadProgress();
  </script>
</body>
</html>