<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Module 1 — Assignment 1: Fire Escape (Video)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

    :root{
      --bg:#07102a;
      --card:#0f1724;
      --muted:#cfe5ff;
      --accent:#ff6b35;
      --success:#22c55e;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.03);
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,var(--bg), #021024);
      color:#e6f0ff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .wrap{
      max-width:var(--maxw);
      margin:28px auto;
      padding:20px;
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:20px;
    }
    .left, .right{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    h1{margin:0;font-size:20px;color:var(--accent)}
    .sub{color:var(--muted);opacity:0.9;font-size:13px}

    /* Video area */
    .video-wrap{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;box-shadow:0 8px 24px rgba(2,6,23,0.6)}
    .video-embed{width:100%;height:0;padding-bottom:56.25%;position:relative;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    .video-embed iframe{position:absolute;inset:0;width:100%;height:100%;border:0;}

    /* Description */
    .meta{margin-top:12px;background:var(--glass);padding:12px;border-radius:8px}
    .meta h4{margin:0 0 8px 0;font-size:15px}
    .meta p{margin:0;font-size:13px;color:#d6e9ff;line-height:1.4}

    /* Quiz */
    form.quiz{margin-top:18px;display:flex;flex-direction:column;gap:12px}
    .question{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
    .question h4{margin:0 0 8px 0;font-size:14px}
    .options{display:grid;gap:8px}
    .opt{
      display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);
      cursor:pointer;background:transparent;
    }
    .opt input{transform:scale(1.05)}
    .opt:hover{background:rgba(255,255,255,0.02)}
    .actions{display:flex;gap:10px;align-items:center;margin-top:10px}
    .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .note{font-size:13px;color:var(--muted)}

    /* Right panel */
    .card-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .progress-ring{width:200px;height:200px;margin:10px auto}
    .stats{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .stat{display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}

    /* result highlight */
    .correct{border-left:6px solid var(--success);background:rgba(34,197,94,0.03)}
    .incorrect{border-left:6px solid var(--danger);background:rgba(239,68,68,0.03)}

    /* modal */
    .modal{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(2,6,23,0.5),rgba(2,6,23,0.6));
    }
    .modal-inner{background:var(--card);padding:20px;border-radius:12px;width:380px;border:1px solid rgba(255,255,255,0.04);text-align:center}
    .modal-inner h3{margin:0 0 8px 0;color:var(--accent)}
    .modal-inner p{margin:0 0 12px 0;color:var(--muted)}
    .close-btn{background:#fff;color:#000;border-radius:8px;padding:8px 12px;border:none;cursor:pointer}

    @media (max-width:980px){
      .wrap{grid-template-columns:1fr}
      .right{order:2}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="left">
      <header>
        <div>
          <h1>Module 1 • Fire Escape</h1>
          <div class="sub">Assignment 1 — Kitchen Fire Scenario (Video)</div>
        </div>
        <div style="text-align:right">
          <div class="sub">Est. time: <strong>8–10 min</strong></div>
          <a class="btn ghost" href="module1.html" style="margin-top:8px;display:inline-block">Back to Module</a>
        </div>
      </header>

      <div class="video-wrap">
        <div class="video-embed" aria-hidden="false">
          <!-- Updated YouTube embed (clean embed URL) -->
          <iframe src="https://www.youtube.com/embed/dqxqjDHz4RA"
            title="Fire Safety Demonstration" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>

        <div class="meta" role="region" aria-labelledby="descTitle" style="margin-top:12px">
          <h4 id="descTitle">Video Description</h4>
          <p>
            This demonstration covers practical, step-by-step actions during a small kitchen fire: identifying the source (grease vs electrical), safe shut-off of fuel or power, correct smothering techniques (lid, blanket), appropriate use of portable extinguishers, and when to evacuate and call emergency services. The presenter stresses safe distances, PASS technique, and checking for re-ignition.
          </p>

          <h4 style="margin-top:10px">Learning Objectives</h4>
          <ul style="margin:6px 0 0 18px;color:#d6e9ff;line-height:1.4">
            <li>Identify the type of kitchen fire and the correct initial response.</li>
            <li>Apply safe smothering methods and decide when to use an extinguisher.</li>
            <li>Follow sequences to shut off fuel/electrical sources safely.</li>
            <li>Recognize when to prioritize evacuation over firefighting.</li>
          </ul>
        </div>
      </div>

      <!-- Quiz -->
      <form class="quiz" id="quizForm" aria-label="Quiz for Assignment 1">
        <!-- Questions injected by JS -->
      </form>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
        <div class="note">Each question: <strong>1 mark</strong>. Total: 10 marks.</div>
        <div class="actions">
          <button class="btn" id="submitBtn" type="button">Submit Answers</button>
          <button class="btn ghost" id="clearBtn" type="button">Reset Answers</button>
        </div>
      </div>
    </div>

    <aside class="right" aria-label="Progress & Stats">
      <div class="card-title">
        <div><strong style="color:var(--muted)">Progress</strong><div style="font-size:12px;color:#bcd8ff">Module 1 — Fire Escape</div></div>
        <div style="font-size:12px;color:var(--muted)">Assignment 1</div>
      </div>

      <div style="text-align:center">
        <svg viewBox="0 0 36 36" class="progress-ring" id="progressSvg" width="200" height="200" aria-hidden>
          <path d="M18 2.0845
            a 15.9155 15.9155 0 0 1 0 31.831
            a 15.9155 15.9155 0 0 1 0 -31.831"
            fill="none" stroke="#374151" stroke-width="3.5"></path>
          <path id="progressArc" d="M18 2.0845
            a 15.9155 15.9155 0 0 1 0 31.831
            a 15.9155 15.9155 0 0 1 0 -31.831"
            fill="none" stroke="#22c55e" stroke-width="3.5" stroke-dasharray="0 100"></path>
          <text x="18" y="20.5" font-size="6" text-anchor="middle" fill="#fff" id="progressText">0%</text>
        </svg>
      </div>

      <div class="stats">
        <div class="stat"><div style="font-size:14px">Completed Assignments</div><div id="completedCount">0 / 15</div></div>
        <div class="stat"><div style="font-size:14px">Your score (this assignment)</div><div id="lastScore">—</div></div>
        <div class="stat"><div style="font-size:14px">Module Avg. (so far)</div><div id="avgScore">—</div></div>
      </div>

      <div style="margin-top:12px;font-size:13px;color:var(--muted)">
        Tip: Watch the video fully before answering. For the field training assignments (every 4th), you'll upload a photo as proof to earn bonus points.
      </div>
    </aside>
  </div>

  <!-- modal -->
  <div class="modal" id="resultModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-inner" role="document">
      <h3>Well done!</h3>
      <p id="modalMsg">You scored X / 10</p>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
        <button class="close-btn" id="modalOk">OK</button>
      </div>
    </div>
  </div>

  <script>
    /***** QUESTIONS (10 MCQs) - related to the embedded video content *****/
    const QUESTIONS = [
      {
        q: "What is the safest first action if a small pan fire starts while cooking?",
        options: ["Throw water on the pan", "Turn off the heat source and cover with a lid", "Blow on the flames", "Move the pan to another room immediately"],
        a: 1
      },
      {
        q: "Which method is recommended to smother a small grease fire?",
        options: ["Use a fire blanket or fitted lid", "Pour cooking oil over it", "Spray canned aerosol", "Fan it with a cloth"],
        a: 0
      },
      {
        q: "Why should you NOT pour water on a grease fire?",
        options: ["Water cools the oil too slowly", "Water can cause the burning oil to splash and spread the fire", "It makes the food tastier", "Water will extinguish it safely every time"],
        a: 1
      },
      {
        q: "The PASS technique stands for:",
        options: ["Pull, Aim, Squeeze, Sweep", "Push, Alert, Spray, Stop", "Pull, Alert, Stand, Sweep", "Protect, Aim, Squeeze, Stay"],
        a: 0
      },
      {
        q: "If the fire is electrical (originated from appliance), which extinguisher class is most suitable?",
        options: ["Class A", "Class B", "Class C (or multipurpose ABC)", "Class D"],
        a: 2
      },
      {
        q: "Before trying to fight a fire, you should always:",
        options: ["Ensure you have a clear escape route", "Stand between the fire and the exit", "Turn off the smoke alarm", "Call a neighbor to film it"],
        a: 0
      },
      {
        q: "After putting out a small stove fire, best practice is to:",
        options: ["Re-ignite the stove to check", "Ventilate and monitor for re-ignition; have appliance inspected if necessary", "Leave immediately without checking", "Pour oil to absorb residue"],
        a: 1
      },
      {
        q: "Which of these is an unsafe action during a kitchen fire?",
        options: ["Using a properly rated extinguisher", "Smothering a grease fire with a lid", "Using water on oil fires", "Calling emergency services if unsure"],
        a: 2
      },
      {
        q: "If you smell gas strongly and suspect a leak during a small fire, you should:",
        options: ["Switch electrical switches on/off to test", "Evacuate and call emergency services from a safe place", "Light a match to find the leak", "Ignore it and keep cooking"],
        a: 1
      },
      {
        q: "When using a fire blanket, the correct approach is to:",
        options: ["Throw it quickly from far away to cover the flames", "Approach carefully, protect your hands, and place it over the fire", "Wet it first then throw", "Place it under the pan"],
        a: 1
      }
    ];

    // STORAGE key same as module page
    const STORAGE_KEY = 'lifesafe_module1_progress';
    const ASSIGNMENT_NUMBER = 1;
    const TOTAL_ASSIGNMENTS = 15;

    // DOM refs
    const quizForm = document.getElementById('quizForm');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultModal = document.getElementById('resultModal');
    const modalMsg = document.getElementById('modalMsg');
    const modalOk = document.getElementById('modalOk');
    const completedCountEl = document.getElementById('completedCount');
    const lastScoreEl = document.getElementById('lastScore');
    const avgScoreEl = document.getElementById('avgScore');
    const progressText = document.getElementById('progressText');
    const progressArc = document.getElementById('progressArc');

    // render questions
    function renderQuestions(){
      QUESTIONS.forEach((item, idx) => {
        const qDiv = document.createElement('div');
        qDiv.className = 'question';
        qDiv.innerHTML = `<h4>Q${idx+1}. ${item.q}</h4><div class="options" role="radiogroup" aria-labelledby="q${idx+1}"></div>`;
        const opts = qDiv.querySelector('.options');
        item.options.forEach((op, oi) => {
          const id = `q${idx}_opt${oi}`;
          const label = document.createElement('label');
          label.className = 'opt';
          label.innerHTML = `<input type="radio" name="q${idx}" id="${id}" value="${oi}" /> <span style="font-size:14px">${op}</span>`;
          opts.appendChild(label);
        });
        quizForm.appendChild(qDiv);
      });
    }

    // load progress
    function loadProgress(){
      try{
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {completed:[], scores:{}};
      }catch(e){
        return {completed:[], scores:{}};
      }
    }
    function saveProgress(obj){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
    }

    function updateRightPanel(){
      const p = loadProgress();
      const done = p.completed.length;
      completedCountEl.textContent = `${done} / ${TOTAL_ASSIGNMENTS}`;
      const lastScore = p.scores && p.scores[ASSIGNMENT_NUMBER] !== undefined ? p.scores[ASSIGNMENT_NUMBER] : '—';
      lastScoreEl.textContent = lastScore === '—' ? '—' : `${lastScore} / 10`;
      // average across available scored assignments
      const scoresArr = Object.values(p.scores||{}).filter(v=>typeof v === 'number');
      const avg = scoresArr.length ? (scoresArr.reduce((a,b)=>a+b,0)/scoresArr.length).toFixed(1) : '—';
      avgScoreEl.textContent = avg === '—' ? '—' : `${avg} / 10`;

      // progress ring
      const pct = Math.round((done / TOTAL_ASSIGNMENTS) * 100);
      progressText.textContent = pct + '%';
      const circumference = 100;
      const dash = (pct/100)*circumference;
      progressArc.setAttribute('stroke-dasharray', `${dash} ${circumference - dash}`);
    }

    // validate all answered
    function validateAnswers(){
      for(let i=0;i<QUESTIONS.length;i++){
        const els = document.getElementsByName('q'+i);
        let answered = false;
        for(const e of els){ if(e.checked){ answered = true; break; } }
        if(!answered) return false;
      }
      return true;
    }

    // compute score and show result
    function gradeAndSave(){
      // compute
      let score = 0;
      QUESTIONS.forEach((item, idx) => {
        const ans = document.querySelector(`input[name="q${idx}"]:checked`);
        const chosen = ans ? parseInt(ans.value,10) : null;
        const qDiv = ans ? ans.closest('.question') : document.getElementsByClassName('question')[idx];
        if(chosen === item.a){
          score += 1;
          if(qDiv) { qDiv.classList.remove('incorrect'); qDiv.classList.add('correct'); }
        } else {
          if(qDiv) { qDiv.classList.remove('correct'); qDiv.classList.add('incorrect'); }
        }
      });

      // load/save progress
      const state = loadProgress();
      if(!Array.isArray(state.completed)) state.completed = [];
      if(!state.scores) state.scores = {};

      // add assignment number if missing
      if(!state.completed.includes(ASSIGNMENT_NUMBER)){
        state.completed.push(ASSIGNMENT_NUMBER);
      }
      // store numeric score
      state.scores[ASSIGNMENT_NUMBER] = score;
      saveProgress(state);

      // show modal and redirect after OK
      modalMsg.textContent = `You scored ${score} / ${QUESTIONS.length}`;
      resultModal.style.display = 'flex';
      resultModal.setAttribute('aria-hidden','false');
      updateRightPanel();

      // animate submit button
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitted ✓';
    }

    // event handlers
    submitBtn.addEventListener('click', function(){
      if(!validateAnswers()){
        alert('Please answer all questions before submitting.');
        return;
      }
      gradeAndSave();
    });

    clearBtn.addEventListener('click', function(){
      // clear all radios
      document.querySelectorAll('input[type="radio"]').forEach(r=>r.checked=false);
      // remove highlights
      document.querySelectorAll('.question').forEach(q=>{q.classList.remove('correct','incorrect')});
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Answers';
    });

    modalOk.addEventListener('click', function(){
      resultModal.style.display = 'none';
      resultModal.setAttribute('aria-hidden','true');
      // redirect back to module page
      window.location.href = 'module1.html';
    });

    // init
    renderQuestions();
    updateRightPanel();

    // accessibility: allow clicking option label to check radio (handled by input inside label)
  </script>
</body>
</html>